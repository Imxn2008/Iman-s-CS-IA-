<!DOCTYPE html>
<pyhthon database.py >
<html lang="en">
    <body style="background-color:#F8F7F3 ;"> 
    <head> 
    <style>
    .homebtn {
    background-color: none;
    color: none;
    font-size: 15px;
    padding: 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    }
    #subjectBox {
    position: relative;
    width: 450px;
    height: 700px;
    left: 10px;
    top: 25px;
    } 

    .subjectBoxImg {
    width: 100%;
    height: 100%;
    display:block;
    }

    /* This box is your RED rectangle area */
    #slot1{
    position: absolute;

    /* üëá These numbers control where the red box is */
    left: 35px;
    top: 110px;
    width: 380px;
    height: 120px;

    /* centers the button inside that rectangle */
    display: flex;
    align-items: center;
    justify-content: center;
    }

    .addSubjectBtn{
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    }

    #subjectBox{
    position: relative;
    width: 450px;
    height: 700px;
    left: 10px;
    top: 25px;
    }

    .subjectBoxImg{
    width: 100%;
    height: 100%;
    display: block;
    }

    /* Each overlay slot sits on top of one ‚Äúrectangle‚Äù in your image */
    .slot{
    position: absolute;
    border-radius: 18px; /* match your rounded box look */
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    box-sizing: border-box;
    }

    /* STARTER POSITIONS (you will tweak these numbers) */
    .slot[data-slot="0"]{ left: 45px; top: 120px; width: 380px; height: 110px; }
    .slot[data-slot="1"]{ left: 45px; top: 250px; width: 380px; height: 110px; }
    .slot[data-slot="2"]{ left: 45px; top: 380px; width: 380px; height: 110px; }
    .slot[data-slot="3"]{ left: 50px; top: 515px; width: 380px; height: 110px; }
    .slot[data-slot="4"]{ left: 45px; top: 650px; width: 380px; height: 110px; } /* may be too low; tweak */

    /* The ‚ÄúAdd subject‚Äù look */
    .slot .addHint{
    cursor: pointer;
    font-size: 16px;
    padding: 10px 14px;
    border-radius: 10px;
    }

    /* Inline form styling */
    .inlineForm{
    width: 100%;
    display: grid;
    gap: 6px;
    }

    .inlineForm input{
    width: 100%;
    padding: 6px;
    border-radius: 8px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    }

    .inlineForm .row{
    display: flex;
    gap: 8px;
    }

    .inlineForm button{
    padding: 6px 10px;
    border-radius: 8px;
    cursor: pointer;
    }

    /* Saved subject display */
    .subjectCard{
    width: 100%;
    text-align: left;
    font-size: 20px;
    line-height: 1.2;
    }
    .subjectCard .title{
    font-weight: 700;
    margin-bottom: 6px;
    }
    .subjectCard .meta{
    font-size: 16px;
    }

    
    </style>

<!--The following code is for the navigation panel -->

    <button class ="logo"> 
        <img src="./Elements/Purple logo.png" style = "width: 120px;height:120px; ">
    </button>
    <button id="navigateButton" onclick="location.href='index.html'" class="Home" style = "position: relative;width: 220px;height: 90px;left: 200px;top: 0.5px;"style="box-shadow: 10px 10px 5px grey;"> 
        <img src="./Elements/Home .png"style="box-shadow: 10px 10px 5px grey;">
    </button>
    <button onclick="location.href='Timetablepage.html'" class="Timetable" style = "position: relative;width: 350px;height: 90px;left: 250px;top: 0.5px;" style="box-shadow: 10px 10px 5px grey;">
        <img src="./Elements/Timetable.png "style="box-shadow: 10px 10px 5px grey;" >
    </button>
    <button onclick="location.href='Motivationpage.html'" class="Timetable"style = "position: relative;width: 400px;height: 90px;left: 300px;top: 0.5px;" style="box-shadow: 10px 10px 5px grey;" >
        <img src="./Elements/Motivation.png "style="box-shadow: 10px 10px 5px grey;">
    </button>

    <!--The following code is for the home page layout -->

     <!-- <background class="Subject list" >
        <img src="./Elements/Subject box.png "style = "position: relative;width: 450px;height: 700px;left: 10px;top: 25px;">
    </background> -->
    <!-- <div id="subjectBox">
      <img src="./Elements/Subject box.png" class="subjectBoxImg">

      <button id="addBtn" class="addSubjectBtn">+ Add Subject</button>
    </div> -->

    <!-- <div id="subjectBox">
      <img src="./Elements/Subject box.png" class="subjectBoxImg"> -->

    <!-- This invisible overlay matches the 'first subject' rectangle --> 
      <!-- <div id="slot1">
        <button id="addBtn" class="addSubjectBtn">Add Subject</button>
      </div>
    </div> -->

    <div id="subjectBox">
    <img src="./Elements/Subject box.png" class="subjectBoxImg" style = "position: relative;width: 500px;height: 800px;left: -37px;top: 5px;"  >

    <!-- 5 overlay slots (adjust positions in CSS) -->
    <div class="slot" data-slot="0"></div>
    <div class="slot" data-slot="1"></div>
    <div class="slot" data-slot="2"></div>
    <div class="slot" data-slot="3"></div>
    <div class="slot" data-slot="4"></div>
    </div>


    
    <background class="progress" >
        <img src="./Elements/Progess bar.png "style = "position: relative;width: 300px;height: 95px;left: 490px; bottom: 674px;">
    </background>

    

    <!--The below code has been taken from ChatGPT with my changes to the styling-->
    
   <!-- <button id="addBtn">Add Subject </button> -->

  <div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4);">
    <div style="background:white; width:320px; margin:10% auto; padding:16px; border-radius:10px;">
      <h3>Add Subject</h3>

      <label>Subject</label>
      <input id="subject" type="text" style="width:100%;"/>

      <label>CurrentGrade</label>
      <input id="current grade" type="integer" style="width:100%;"/>

      <label>Target grade</label>
      <input id="target grade" type="integer" style="width:100%;"/>

      <div style="margin-top:12px;">
        <button id="saveBtn">Save</button>
        <button id="closeBtn">Close</button>
      </div>
    </div>
  </div>

<script>
document.getElementById("saveBtn").addEventListener("click", () => {
    const subject = document.getElementById("subject").value.trim();
    const currentGrade = document.getElementById("current grade").value.trim();
    const targetGrade = document.getElementById("target grade").value.trim();


    if (!subject || !currentGrade || !targetGrade) {
        alert("Please fill in all fields.");
        return;
    }

    if (!/^[A-Za-z\s]+$/.test(subject)) {
        alert("Subject must contain letters only.");
        return;
    }

    if (isNaN(current) || isNaN(target)) {
        alert("Grades must be numbers.");
        return;
    }

    const content =
        `Subject: ${subject}\n` +
        `Current: ${current}\n` +
        `Target: ${target}\n` +
        `----------------------\n`;

    const blob = new Blob([content], { type: "text/plain" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "database.txt";
    a.click();

    URL.revokeObjectURL(url);
});
</script>

<ul id="list"></ul>

<script>
  
  // One entry per slot (5 slots)
  const subjects = Array(5).fill(null);
  const slots = document.querySelectorAll(".slot");

  function renderSlot(i) {
    const slot = document.querySelector(`.slot[data-slot="${i}"]`);
    const item = subjects[i];

    // If empty: show "Add Subject"
    if (!item) {
      slot.innerHTML = `<div class="addHint">+ Add Subject</div>`;
      slot.querySelector(".addHint").onclick = () => showForm(i);
      return;
    }

    // If saved: show subject info (click to edit)
    slot.innerHTML = `
      <div class="subjectCard">
        <div class="title">${escapeHtml(item.subject)}</div>
        <div class="meta">CurrentGrade: ${escapeHtml(item.currentGrade)} | Target: ${escapeHtml(item.targetGrade)}</div>
        <div class="meta" style="margin-top:6px; opacity:0.8;">Click to edit</div>
      </div>
    `;
    slot.onclick = () => showForm(i);
  }

  function showForm(i) {
    const slot = document.querySelector(`.slot[data-slot="${i}"]`);
    const existing = subjects[i] || { subject: "", currentGrade: "", targetGrade: "" };

    slot.onclick = null; // disable card click while editing

    slot.innerHTML = `
      <form class="inlineForm" onsubmit="return false;">
        <input id="sub-${i}" placeholder="Subject" value="${escapeAttr(existing.subject)}" />
        <div class="row">
          <input id="cur-${i}" placeholder="Current Grade" value="${escapeAttr(existing.currentGrade)}" />
          <input id="tar-${i}" placeholder="Target Grade" value="${escapeAttr(existing.targetGrade)}" />
        </div>
        <div class="row">
          <button type="button" id="save-${i}">Save</button>
          <button type="button" id="cancel-${i}">Cancel</button>
          <button type="button" id="clear-${i}" style="margin-left:auto;">Clear</button>
        </div>
      </form>
    `;

    slot.querySelector(`#save-${i}`).onclick = () => {
      const subject = document.getElementById(`sub-${i}`).value.trim();
      const currentGrade = document.getElementById(`cur-${i}`).value.trim();
      const targetGrade = document.getElementById(`tar-${i}`).value.trim();
      alert("Your subject has been saved");

      if (!subject || !currentGrade || !targetGrade) {
        alert("Fill in all fields");
        return;
      }

      if (!/^[A-Za-z\s]+$/.test(subject)) {
        alert("Subject must contain letters only.");
        return;
      }

      if (isNaN(currentGrade) || isNaN(targetGrade)) {
        alert("Grades must be numbers.");
        return;
      }

      subjects[i] = { subject, currentGrade, targetGrade };
      renderSlot(i);
      saveToStorage();
    };

    slot.querySelector(`#cancel-${i}`).onclick = () => {
      renderSlot(i);
    };

    slot.querySelector(`#clear-${i}`).onclick = () => {
      subjects[i] = null;
      renderSlot(i);
      saveToStorage();
    };
  }

  const API_BASE = "http://127.0.0.1:5000/api";

  // Persist data in backend; fall back to browser storage if backend is offline.
  async function saveToStorage() {
    localStorage.setItem("subjects", JSON.stringify(subjects));
    try {
      await fetch(`${API_BASE}/subjects`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(subjects),
      });
    } catch (error) {
      console.warn("Backend not reachable, saved locally instead.", error);
    }
  }

  async function loadFromStorage() {
    try {
      const response = await fetch(`${API_BASE}/subjects`);
      if (response.ok) {
        const data = await response.json();
        if (Array.isArray(data) && data.length === subjects.length) {
          for (let i = 0; i < subjects.length; i++) subjects[i] = data[i];
          return;
        }
      }
    } catch (error) {
      console.warn("Backend not reachable, loading local data instead.", error);
    }

    const raw = localStorage.getItem("subjects");
    if (!raw) return;
    try {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed) && parsed.length === subjects.length) {
        for (let i = 0; i < subjects.length; i++) subjects[i] = parsed[i];
      }
    } catch {}
  }

  // Safety helpers
  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }
  function escapeAttr(str) {
    return escapeHtml(str).replaceAll('"', "&quot;");
  }

  // Init
  async function init() {
    await loadFromStorage();
    for (let i = 0; i < subjects.length; i++) renderSlot(i);
  }
  init();
</script>

</script>

    </head>
    </body>
</html>
